<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>電波人間 装備データベース</title>
    <style>
        /* --- 省略（あなたのスタイルそのまま） --- */
    </style>
</head>
<body>
    <!-- --- 省略（あなたのHTMLそのまま） --- -->

    <script>
        // データストレージ
        let equipmentData = [];
        let currentCategory = '';
        
        // フィルター関連の変数
        let selectedStars = new Set();
        let selectedFilterTags = new Set();
        let isFilterVisible = true;

        // 初期化
        document.addEventListener('DOMContentLoaded', async function() {
            loadDataFromJSON();
        });

        // --- 省略（あなたのJSそのまま） ---

        // JSONデータ読み込み
        async function loadDataFromJSON() {
            try {
                // ★ここを相対パスに修正★
                const res = await fetch('./soubihyou.json', {
                    headers: {
                        'Cache-Control': 'no-cache'
                    }
                });
                
                if (!res.ok) {
                    if (res.status === 404) {
                        console.warn('soubihyou.jsonが見つかりませんでした。新しいデータで開始します。');
                        equipmentData = [];
                    } else {
                        console.error(`データ読み込み失敗: ${res.status} ${res.statusText}`);
                        equipmentData = [];
                    }
                } else {
                    const text = await res.text();
                    if (text.trim()) {
                        try {
                            const data = JSON.parse(text);
                            equipmentData = Array.isArray(data) ? data : [];
                            console.log('装備データ読み込み完了:', equipmentData.length, '件');
                        } catch (parseError) {
                            console.error('JSON解析エラー:', parseError);
                            equipmentData = [];
                        }
                    } else {
                        console.log('空のファイルです。新しいデータで開始します。');
                        equipmentData = [];
                    }
                }
            } catch (e) {
                console.error('装備データの読み込みに失敗しました:', e);
                equipmentData = [];
            } finally {
                setupEventListeners();
                initializeFilters(); // フィルターを初期化
                showCategoryView();
            }
        }
    </script>
</body>
</html>
